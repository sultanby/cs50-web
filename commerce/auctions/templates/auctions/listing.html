{% extends "auctions/layout.html" %}

{% block body %}

    <h2> Auctions Listing</h2>

    {% if user.is_authenticated %}

        <form action="{% url 'listing' listing.id %}" method="post">
            {% csrf_token %}
            <ul>
                <li>Name of listing: {{ listing.name_of_listing }}</li>
                <li>Description: {{ listing.listing_description }}</li>
                <li>Starting bid: {{ listing.starting_bid }} $</li>
                <li>Image:<br> <img src="{{listing.image}}"> </li>
                <li>Owner:
                {% if my_listing %}
                    YOU!
                {% else %}
                    {{ listing.listings_owner }}
                {% endif %}</li>
            </ul>
        </form>

        {% if my_listing %}
            {% if listing.is_closed == False %}
            <form method="POST" action="{% url 'close_listing' listing.id %}">
                {% csrf_token %}
                <button type = submit value="submit">
                    close this listing
                </button>
            </form>
            {% endif %}
        {% endif %}


        <form action="{% url 'watchlist' listing.id %}" method="POST">
            {% csrf_token %}
            <button type="submit">
                {% if is_in_watchlist %}
                remove from watchlist
                {% else %}
                add to watchlist
                {% endif %}
            </button>
        </form>

        {% if listing.is_closed == False %}
            last bid is: {{ listing.current_bid| default:listing.starting_bid}} $ made by: {{ last_bidder.last_bidder }}
            {% if error %}
                Your bid must be bigger than {{ listing.current_bid| default:listing.starting_bid}} $
            {% endif %}
            {% if listing.listings_owner != user %}
                <form action="{% url 'bid' listing.id %}" method="post">
                    {% csrf_token %}
                    <input class="form-control" type="number" name="offer" placeholder="New bid">
                    <input type = submit value="submit">
                </form>
            {% endif %}
        {% else %}
            {% if my_listing %}
                {% if last_bidder.last_bidder %}
                    Your listing goes to {{ last_bidder.last_bidder }}
                {% else %}
                    No buyers
                {% endif %}
            {% else %}
                {% if user == last_bidder.last_bidder %}
                    You won this listing!!
                {% else %}
                    Winner is {{ last_bidder.last_bidder }}
                {% endif %}
            {% endif %}
        {% endif %}

        <form action="{% url 'comment' listing.id %}" method="post">
            {% csrf_token %}
            <textarea class="form-control" type="text" name="comment" placeholder="Place your comment here"></textarea>
            <input type = submit value="submit">
        </form>
        {% for comment in all_comments %}
            <br>
            author: {{comment.commentator}}
            comment: {{comment.comment}}
            at: {{comment.comment_time}}
            <br>
        {% endfor %}

    {% else %}
        Already have an account? <a href="{% url 'login' %}">Log In here.</a>
    {% endif %}
{% endblock %}